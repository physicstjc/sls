<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Electrostatic Precipitator Simulation</title>
  <style>
    body {
      font-family: 'Roboto', 'Segoe UI', Tahoma, sans-serif;
      margin: 0;
      padding: 16px;
      background: #f5f5f5;
      color: #212121;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      width: 800px;
      height: 480px;
      background: #ffffff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.12), 0 2px 4px rgba(0,0,0,0.08);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .simulation-area { flex: 1; padding: 12px; display: flex; flex-direction: column; }
    canvas {
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      background: linear-gradient(to right, #e8f4f8 0%, #d1e7dd 50%, #f8f9fa 100%);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
      flex: 1;
    }
    .controls-panel {
      background: #fafafa;
      padding: 12px;
      border-top: 1px solid #e0e0e0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .controls-row { display: flex; justify-content: center; gap: 8px; }
    button {
      padding: 6px 16px;
      font-size: 12px;
      font-weight: 500;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.16);
      min-width: 60px;
    }
    .btn-on { background-color: #4caf50; color: #fff; }
    .btn-off { background-color: #f44336; color: #fff; }
    .btn-reset { background-color: #ff9800; color: #fff; }
    .status-card {
      background: #fff; border: 1px solid #e0e0e0; border-radius: 4px;
      padding: 8px 12px; font-size: 13px; font-weight: 500; text-align: center;
    }
    .status-on { background: #e8f5e8; border-color: #4caf50; color: #2e7d32; }
    .status-off { background: #ffebee; border-color: #f44336; color: #c62828; }
    .info-row { display: flex; justify-content: space-between; font-size: 11px; color: #666; margin-top: 4px; }
    .legend { display: flex; gap: 12px; font-size: 10px; color: #666; justify-content: center; flex-wrap: wrap; }
    .legend-item { display: flex; align-items: center; gap: 4px; background: rgba(0,0,0,0.04); padding: 2px 6px; border-radius: 12px; }
    .legend-dot { width: 8px; height: 8px; border-radius: 50%; }
  </style>
</head>
<body>
  <div class="container">
    <div class="simulation-area">
      <canvas id="canvas" width="776" height="320"></canvas>
      <div class="legend">
        <div class="legend-item"><div class="legend-dot" style="background:#2196f3;"></div><span>Clean Air</span></div>
        <div class="legend-item"><div class="legend-dot" style="background:#795548;"></div><span>Dust/Smoke</span></div>
        <div class="legend-item"><div class="legend-dot" style="background:#ffb300;"></div><span>Charged (âˆ’)</span></div>
        <div class="legend-item"><div class="legend-dot" style="background:#424242;"></div><span>Negative Plates</span></div>
        <div class="legend-item"><div class="legend-dot" style="background:#f44336;"></div><span>Positive Plates</span></div>
      </div>
    </div>
    <div class="controls-panel">
      <div class="controls-row">
        <button class="btn-on" onclick="turnOn()">On</button>
        <button class="btn-off" onclick="turnOff()">Off</button>
        <button class="btn-reset" onclick="resetSystem()">Reset</button>
      </div>
      <div id="status" class="status-card status-off">System Offline - No Electric Field</div>
      <div class="info-row">
        <div id="stats">Particles: 0 | Collected: 0</div>
        <div id="voltage" style="opacity:0;"></div>
      </div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const statusDiv = document.getElementById('status');
    const statsDiv = document.getElementById('stats');
    const voltageDiv = document.getElementById('voltage');

    let isOn = false;
    let particles = [];
    let airParticles = [];
    let collectedParticles = [];
    let animationId;

    const HOUSING = { x:20, y:40, width:736, height:240 };
    const INLET = { x:15, y:140, width:10, height:40 };
    const OUTLET = { x:751, y:140, width:10, height:40 };

    // Helper: evenly distribute plates vertically within housing
    function makeEvenVerticalPlates(x, plateWidth, plateHeight, count) {
      const totalPlateH = count * plateHeight;
      const gaps = count + 1;
      const gap = (HOUSING.height - totalPlateH) / gaps; // equal top, between, bottom
      const plates = [];
      for (let i = 0; i < count; i++) {
        const y = HOUSING.y + gap + i * (plateHeight + gap);
        plates.push({ x, y, width: plateWidth, height: plateHeight });
      }
      return plates;
    }

    // Plate geometry
    const NEG_X = 120, POS_X = 550;
    const PLATE_W = 75, PLATE_H = 6, PLATE_COUNT = 7;

    let negativePlates = makeEvenVerticalPlates(NEG_X, PLATE_W, PLATE_H, PLATE_COUNT);
    let positivePlates = makeEvenVerticalPlates(POS_X, PLATE_W, PLATE_H, PLATE_COUNT);

    class DustParticle {
      constructor() {
        this.x = 30 + Math.random() * 50;
        this.y = 80 + Math.random() * 160;
        this.vx = 1.8 + Math.random() * 1.2;
        this.vy = (Math.random() - 0.5) * 0.6;
        this.radius = 1.5 + Math.random() * 2;
        this.charged = false;
        this.collected = false;
        this.opacity = 0.9;
        this.mass = this.radius * 0.5;
      }
      update() {
        if (this.collected) return;

        this.x += this.vx;
        this.y += this.vy;

        // Charge particles when they pass the negative-plate region
        const chargeRegionMinX = NEG_X;
        const chargeRegionMaxX = NEG_X + PLATE_W;
        if (isOn && !this.charged && this.x > chargeRegionMinX && this.x < chargeRegionMaxX) {
          this.charged = true;
        }

        // Attraction to positive plates
        if (isOn && this.charged && this.x > POS_X - 50) {
          let nearest = null, minDist = Infinity;
          for (let plate of positivePlates) {
            const center = plate.y + plate.height / 2;
            const d = Math.abs(this.y - center);
            if (d < minDist && this.x > plate.x - 30 && this.x < plate.x + plate.width + 30) {
              minDist = d; nearest = plate;
            }
          }
          if (nearest && minDist < 40) {
            const f = 0.12 / this.mass;
            const center = nearest.y + nearest.height / 2;
            const dy = center - this.y;
            this.vy += dy * f * 0.04;
            // Collection on plate
            if (Math.abs(dy) < 6 && this.x > nearest.x && this.x < nearest.x + nearest.width) {
              this.collected = true;
              this.y = center;
              collectedParticles.push(this);
            }
          }
        }

        // Boundaries
        if (this.y < HOUSING.y + 10) this.vy = Math.abs(this.vy) * 0.8;
        if (this.y > HOUSING.y + HOUSING.height - 10) this.vy = -Math.abs(this.vy) * 0.8;

        // Exit fade
        if (this.x > canvas.width + 10) this.opacity = 0;
      }
      draw() {
        if (this.opacity <= 0) return;
        ctx.globalAlpha = this.opacity;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        if (this.collected) {
          ctx.fillStyle = '#424242';
        } else if (this.charged) {
          ctx.fillStyle = '#ffb300';     // dark yellow
          ctx.shadowColor = '#ffb300';
          ctx.shadowBlur = 4;
        } else {
          ctx.fillStyle = '#795548';
          ctx.shadowBlur = 0;
        }
        ctx.fill();
        ctx.shadowBlur = 0;
        ctx.globalAlpha = 1;
      }
    }

    class AirParticle {
      constructor() {
        this.x = 25 + Math.random() * 40;
        this.y = 60 + Math.random() * 200;
        this.vx = 2.2 + Math.random() * 0.8;
        this.vy = (Math.random() - 0.5) * 0.4;
        this.radius = 0.5 + Math.random() * 1;
        this.opacity = 0.4 + Math.random() * 0.3;
      }
      update() {
        this.x += this.vx;
        this.y += this.vy;
        if (this.y < HOUSING.y + 20) this.vy = Math.abs(this.vy);
        if (this.y > HOUSING.y + HOUSING.height - 20) this.vy = -Math.abs(this.vy);
        if (this.x > canvas.width + 10) this.opacity = 0;
      }
      draw() {
        if (this.opacity <= 0) return;
        ctx.globalAlpha = this.opacity;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = '#2196f3';
        ctx.fill();
        ctx.globalAlpha = 1;
      }
    }

    function generateParticles() {
      if (Math.random() < 0.7) particles.push(new DustParticle());
      if (Math.random() < 0.9) airParticles.push(new AirParticle());
    }

    function drawSystem() {
      // Housing
      ctx.strokeStyle = '#bdbdbd';
      ctx.lineWidth = 2;
      ctx.strokeRect(HOUSING.x, HOUSING.y, HOUSING.width, HOUSING.height);

      // Inlet/Outlet
      ctx.fillStyle = '#757575';
      ctx.fillRect(INLET.x, INLET.y, INLET.width, INLET.height);
      ctx.fillRect(OUTLET.x, OUTLET.y, OUTLET.width, OUTLET.height);

      // Flow arrows
      ctx.strokeStyle = 'rgba(33, 150, 243, 0.5)';
      ctx.lineWidth = 2;
      for (let i = 0; i < 4; i++) {
        const y = 100 + i * 30;
        // Entry
        ctx.beginPath();
        ctx.moveTo(35, y);
        ctx.lineTo(55, y);
        ctx.moveTo(55, y);
        ctx.lineTo(52, y - 3);
        ctx.moveTo(55, y);
        ctx.lineTo(52, y + 3);
        ctx.stroke();
        // Exit
        ctx.beginPath();
        ctx.moveTo(720, y);
        ctx.lineTo(740, y);
        ctx.moveTo(740, y);
        ctx.lineTo(737, y - 3);
        ctx.moveTo(740, y);
        ctx.lineTo(737, y + 3);
        ctx.stroke();
      }

      // Negative plates (dark grey)
      ctx.fillStyle = isOn ? '#424242' : '#e0e0e0';
      for (let plate of negativePlates) {
        ctx.fillRect(plate.x, plate.y, plate.width, plate.height);
      }

      // Positive plates (red)
      ctx.fillStyle = isOn ? '#f44336' : '#e0e0e0';
      for (let plate of positivePlates) {
        ctx.fillRect(plate.x, plate.y, plate.width, plate.height);
      }

      // Labels
      if (isOn) {
        ctx.fillStyle = '#424242';
        ctx.font = 'bold 12px Roboto';
        ctx.fillText('-40kV', NEG_X + 20, HOUSING.y - 5);

        ctx.fillStyle = '#f44336';
        ctx.fillText('+20kV', POS_X + 20, HOUSING.y - 5);
      }
    }

    function updateDisplay() {
      const active = particles.filter(p => !p.collected).length;
      statsDiv.textContent = `Particles: ${active} | Collected: ${collectedParticles.length}`;
      voltageDiv.textContent = isOn ? 'High Voltage Active' : '';
      voltageDiv.style.opacity = isOn ? '1' : '0';
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      generateParticles();
      drawSystem();

      airParticles = airParticles.filter(p => { p.update(); p.draw(); return p.opacity > 0; });
      particles = particles.filter(p => { p.update(); p.draw(); return p.opacity > 0; });
      collectedParticles.forEach(p => p.draw());

      updateDisplay();
      animationId = requestAnimationFrame(animate);
    }

    function turnOn() {
      isOn = true;
      statusDiv.textContent = 'System Online - Electric Field Active';
      statusDiv.className = 'status-card status-on';
    }
    function turnOff() {
      isOn = false;
      statusDiv.textContent = 'System Offline - No Electric Field';
      statusDiv.className = 'status-card status-off';
      particles.forEach(p => p.charged = false);
    }
    function resetSystem() {
      isOn = false;
      particles = [];
      airParticles = [];
      collectedParticles = [];
      statusDiv.textContent = 'System Reset - Particles Cleared';
      statusDiv.className = 'status-card status-off';
    }

    animate();
  </script>
</body>
</html>
